---
alwaysApply: true
description: "Instrukce pro Cursor AI - HACCP Audit Assistant"
---
Kdyz pracujes podle techto pravidel (napr. zmeny kodu, opravy, pouzivani Flowbite/Firebase), vzdy napis na zacatek odpovedi JEDU PODLE RULES a pak pokracuj v odpovedi.
# Instrukce pro Cursor AI - HACCP Audit Assistant

## ğŸ¯ ZÃKLADNÃ PRAVIDLA

### VÅ¾dy pracuj podle dokumentace
- **Flowbite dokumentace je tvÅ¯j "svatÃ½ grÃ¡l"**: https://flowbite-react.com/
- **Firebase dokumentace**: https://firebase.google.com/docs
- Pokud nÄ›co nevÃ­Å¡, vÅ¾dy nejdÅ™Ã­v zkontroluj dokumentaci
- Pokud nedokÃ¡Å¾eÅ¡ nÄ›co vyÅ™eÅ¡it, napiÅ¡ uÅ¾ivateli kde to najde nebo jak na to

### âš ï¸ AUTOMATICKÃ AKTUALIZACE DOKUMENTACE
- **KdyÅ¾ se mÄ›nÃ­ nÄ›co zÃ¡sadnÃ­ho v projektu, VÅ½DY automaticky aktualizuj relevantnÃ­ dokumenty:**
  - PÅ™idÃ¡nÃ­ novÃ© technologie â†’ aktualizuj `.cursorrules` sekci "Technologie projektu"
  - ZmÄ›na struktury projektu â†’ aktualizuj `.cursorrules` sekci "Struktura projektu"
  - PÅ™idÃ¡nÃ­ novÃ© Firebase sluÅ¾by â†’ aktualizuj `.cursorrules` sekci "Firebase pravidla"
  - ZmÄ›na UI frameworku nebo pravidel â†’ aktualizuj `.cursorrules` a `FLOWBITE_PRIRUCKA.md`
  - PÅ™idÃ¡nÃ­ novÃ©ho dÅ¯leÅ¾itÃ©ho souboru â†’ aktualizuj `.cursorrules` sekci "DÅ¯leÅ¾itÃ© soubory"
- **NepoÄÃ­tej s tÃ­m, Å¾e uÅ¾ivatel si to aktualizuje sÃ¡m - vÅ¾dy to udÄ›lej automaticky!**
- **Aktualizace dokumentace je souÄÃ¡stÃ­ zmÄ›ny, ne samostatnÃ½ krok**

### Technologie projektu
- **Frontend**: React 19.2.0 + TypeScript + Vite
- **UI Framework**: Flowbite React (vÅ¾dy pouÅ¾Ã­vej podle dokumentace!)
- **CSS Framework**: Tailwind CSS v3.4.18 (integrovanÃ½ s Flowbite)
- **Backend**: Firebase (Firestore, Storage, Functions, Authentication)
- **Build**: Vite
- **State Management**: React Hooks + Context API
- **PDF Rendering**: @react-pdf/renderer (pro Smart Template systÃ©m)
- **Drag & Drop**: @dnd-kit/core (pro Smart Template editor)

---

## ğŸ¨ UI PRAVIDLA - FLOWBITE

### âš ï¸ KRITICKÃ‰ PRAVIDLA PRO UI ZMÄšNY:

1. **VÅ½DY pouÅ¾Ã­vej Flowbite komponenty** podle oficiÃ¡lnÃ­ dokumentace
   - Odkaz: https://flowbite-react.com/
   - PÅ™ed kaÅ¾dou zmÄ›nou UI zkontroluj dokumentaci Flowbite

2. **Light mode ONLY** - aplikace je vÅ¾dy v light mode
   - `class="light"` na `<html>` tagu
   - NIKDY nepouÅ¾Ã­vej `dark:` tÅ™Ã­dy
   - NIKDY nepouÅ¾Ã­vej dark mode styling

3. **ZachovÃ¡nÃ­ pÅ¯vodnÃ­ch barev**
   - Pro gradienty: VÅ½DY pouÅ¾Ã­vej inline styles `style={{ background: 'linear-gradient(...)' }}`
   - NIKDY nepouÅ¾Ã­vej Tailwind gradient tÅ™Ã­dy pro barvy (`bg-gradient-to-r`, atd.)
   - Barvy z `constants/designSystem.ts` - SECTION_THEMES

4. **Wrapper komponenty**
   - ExistujÃ­cÃ­ wrappery v `components/ui/` zachovÃ¡vajÃ­ API
   - PouÅ¾Ã­vajÃ­ Flowbite komponenty uvnitÅ™
   - Pokud vytvÃ¡Å™Ã­Å¡ novou komponentu, pouÅ¾ij Flowbite pÅ™Ã­mo, ne wrapper

5. **Icon props**
   - Flowbite vyÅ¾aduje ikony jako funkce: `icon={() => <Icon />}`
   - NIKDY nepouÅ¾Ã­vej: `icon={<Icon />}`

### âœ… Co VÅ½DY dÄ›lat pÅ™i zmÄ›nÃ¡ch UI:

```tsx
// âœ… SPRÃVNÄš - Flowbite podle dokumentace
import { Button } from 'flowbite-react';
<Button color="blue" size="md">Text</Button>

// âœ… SPRÃVNÄš - Gradient pÅ™es inline style
<div style={{
  background: `linear-gradient(to right, ${theme.colors.primary}, ${theme.colors.darkest})`
}}>

// âœ… SPRÃVNÄš - Icon jako funkce
<TextInput icon={() => <SearchIcon />} />
```

### âŒ Co NIKDY nedÄ›lat:

```tsx
// âŒ Å PATNÄš - custom CSS mÃ­sto Flowbite
<button className="px-4 py-2 bg-blue-500">Text</button>

// âŒ Å PATNÄš - Tailwind gradient tÅ™Ã­dy
<div className="bg-gradient-to-r from-blue-500 to-purple-500">

// âŒ Å PATNÄš - dark mode
<div className="bg-white dark:bg-gray-800">

// âŒ Å PATNÄš - icon jako JSX
<TextInput icon={<SearchIcon />} />
```

### ğŸ“š Flowbite dokumentace odkazy:
- **HlavnÃ­**: https://flowbite-react.com/
- **Komponenty**: https://flowbite-react.com/docs/components/button
- **Theme**: https://flowbite-react.com/docs/customize/theme

### ğŸ“ PrÅ¯vodce Flowbite najdeÅ¡ v:
- `FLOWBITE_PRIRUCKA.md` - detailnÃ­ pÅ™Ã­ruÄka pro Flowbite v projektu

---

## ğŸ”¥ FIREBASE PRAVIDLA

### Struktura Firebase sluÅ¾eb:

1. **Firebase Authentication**
   - `contexts/AuthContext.tsx` - wrapper pro Firebase Auth
   - `components/LoginScreen.tsx`, `components/RegisterScreen.tsx`
   - UÅ¾ivatelÃ© jsou izolovÃ¡ni podle `uid`

2. **Firestore Database**
   - VÅ¡echny CRUD operace v `services/firestore/`
   - Collections: `customers`, `audits`, `reports`, `settings`, `users`, `aiUsageLogs`, `reportTemplates`
   - **Security Rules**: `firestore.rules` - user isolation
   - **ID systÃ©m**: Human-readable ID formÃ¡t `{PREFIX}{YYYYMMDD}_{COUNTER}`
     - Audity: `A20250811_0001`, `A20250811_0002`, ...
     - PracoviÅ¡tÄ›: `P20250811_0001`, `P20250811_0002`, ...
     - ProvozovatelÃ©: `O20250811_0001`, `O20250811_0002`, ...
     - Reporty: `R20250811_0001`, `R20250811_0002`, ...
     - ZÃ¡kaznÃ­ci: `C20250811_0001`, `C20250811_0002`, ...
     - Utility: `utils/idGenerator.ts` - `generateHumanReadableId()`

3. **Firebase Storage**
   - `services/storage.ts` - upload/download fotek
   - Fotky auditÅ¯: `users/{userId}/audits/{auditId}/F{YYYYMMDD}_{COUNTER}.jpg`
   - PDF reporty Legacy: `reports/{reportId}/pdf`
   - Smart Template data: `reports/{reportId}/smart/{drafts|finalVersions|pdf|templates}/`
   - **Security Rules**: `storage.rules` - max 10MB pro obrÃ¡zky
   - **Photo filename**: Human-readable formÃ¡t `F{YYYYMMDD}_{COUNTER}.{ext}` (counter per audit + den)
     - Utility: `utils/photoIdGenerator.ts` - `generatePhotoFilename()`

4. **Cloud Functions**
   - `functions/src/` - serverless funkce
   - `generateReport.ts` - Legacy AI generovÃ¡nÃ­ reportÅ¯ (beze zmÄ›ny)
   - `generateSmartReportPdf.ts` - Smart Template PDF generovÃ¡nÃ­ (novÃ¡)
   - `transcribeAudio.ts`, `generatePdf.ts`, `analyzeImage.ts`

### âœ… Co VÅ½DY dÄ›lat pÅ™i prÃ¡ci s Firebase:

```tsx
// âœ… SPRÃVNÄš - pouÅ¾ij existujÃ­cÃ­ service funkce
import { createAudit, updateAudit } from './services/firestore';
await createAudit(auditData);

// âœ… SPRÃVNÄš - pouÅ¾ij AuthContext pro uÅ¾ivatele
import { useAuth } from './contexts/AuthContext';
const { user } = useAuth();

// âœ… SPRÃVNÄš - error handling
try {
  await someFirebaseOperation();
} catch (error) {
  toast.error('Chyba: ' + error.message);
}
```

### âŒ Co NIKDY nedÄ›lat:

```tsx
// âŒ Å PATNÄš - pÅ™Ã­mÃ½ import Firebase SDK v komponentÃ¡ch
import { collection, addDoc } from 'firebase/firestore';
// PouÅ¾Ã­vej service funkce mÃ­sto toho!

// âŒ Å PATNÄš - ignorovÃ¡nÃ­ error handlingu
await createAudit(data); // Co kdyÅ¾ selÅ¾e?
```

### ğŸ“š Firebase dokumentace:
- **Firestore**: https://firebase.google.com/docs/firestore
- **Storage**: https://firebase.google.com/docs/storage
- **Functions**: https://firebase.google.com/docs/functions
- **Auth**: https://firebase.google.com/docs/auth

### ğŸ“ PrÅ¯vodce Firebase najdeÅ¡ v:
- `NAVOD.md` - kompletnÃ­ nÃ¡vod k nastavenÃ­ a deploy
- `README.md` - struktura projektu a Firebase migrace

---

## ğŸ“ STRUKTURA PROJEKTU

### HlavnÃ­ adresÃ¡Å™e:

```
HACCP1/
â”œâ”€â”€ components/          # React komponenty
â”‚   â”œâ”€â”€ ui/              # Flowbite wrapper komponenty (Button, Card, Input, Modal)
â”‚   â”‚   â”œâ”€â”€ Pagination.tsx       # StrÃ¡nkovÃ¡nÃ­ tabulek (NOVÃ)
â”‚   â”‚   â”œâ”€â”€ DetailTooltip.tsx    # DetailnÃ­ tooltip komponenta (NOVÃ)
â”‚   â”‚   â”œâ”€â”€ TooltipCell.tsx      # Wrapper pro td s tooltipem (NOVÃ)
â”‚   â”‚   â”œâ”€â”€ ActionIconTooltip.tsx # Tooltip pro ikony akcÃ­ (NOVÃ)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ icons/           # SVG ikony
â”‚   â”œâ”€â”€ report/          # Smart Template komponenty (NOVÃ)
â”‚   â”‚   â”œâ”€â”€ SmartTemplateView.tsx
â”‚   â”‚   â”œâ”€â”€ SmartTemplateSelector.tsx
â”‚   â”‚   â”œâ”€â”€ SmartReportRenderer.tsx
â”‚   â”‚   â””â”€â”€ SmartReportDesigner.tsx
â”‚   â””â”€â”€ [screens].tsx    # Obrazovky aplikace
â”‚
â”œâ”€â”€ utils/               # Utility funkce
â”‚   â”œâ”€â”€ idGenerator.ts   # Human-readable ID generovÃ¡nÃ­ (NOVÃ)
â”‚   â”œâ”€â”€ photoIdGenerator.ts  # Human-readable photo filename generovÃ¡nÃ­ (NOVÃ)
â”‚   â””â”€â”€ toast.ts         # Toast notifikace
â”‚
â”œâ”€â”€ services/            # Business logika a API
â”‚   â”œâ”€â”€ firestore/       # Firestore CRUD operace
â”‚   â”‚   â”œâ”€â”€ reportTemplates.ts  # Smart Template Å¡ablony (NOVÃ)
â”‚   â”‚   â””â”€â”€ reports.ts           # UPRAVENO - pÅ™idÃ¡na smart pole
â”‚   â”œâ”€â”€ smartTemplate/   # Smart Template sluÅ¾by (NOVÃ)
â”‚   â”‚   â”œâ”€â”€ SmartTemplateEngine.ts
â”‚   â”‚   â”œâ”€â”€ templateLoader.ts
â”‚   â”‚   â””â”€â”€ reportDocumentService.ts
â”‚   â””â”€â”€ storage.ts       # Firebase Storage
â”‚
â”œâ”€â”€ contexts/            # React Contexts
â”‚   â””â”€â”€ AuthContext.tsx  # Firebase Authentication
â”‚
â”œâ”€â”€ hooks/               # Custom React hooks
â”‚   â”œâ”€â”€ useAppData.ts    # NaÄÃ­tÃ¡nÃ­ dat z Firestore
â”‚   â””â”€â”€ useUserRole.ts
â”‚
â”œâ”€â”€ types.ts             # TypeScript typy (UPRAVENO - pÅ™idÃ¡ny Smart typy)
â”œâ”€â”€ types/
â”‚   â””â”€â”€ smartReport.ts   # Smart Template typy (NOVÃ)
â”œâ”€â”€ constants/designSystem.ts  # Design systÃ©m (SECTION_THEMES)
â”‚
â”œâ”€â”€ firebaseConfig.ts    # Firebase inicializace
â”œâ”€â”€ firestore.rules      # Firestore security rules (UPRAVENO - pÅ™idÃ¡ny reportTemplates)
â”œâ”€â”€ storage.rules        # Storage security rules (UPRAVENO - pÅ™idÃ¡ny smart cesty)
â”‚
â””â”€â”€ functions/src/       # Cloud Functions
    â””â”€â”€ generateSmartReportPdf.ts  # Smart Template PDF (NOVÃ)
```

### DÅ¯leÅ¾itÃ© soubory:

- **`App.tsx`** - hlavnÃ­ logika aplikace, routing
- **`AppWithAuth.tsx`** - wrapper s autentifikacÃ­
- **`firebaseConfig.ts`** - Firebase SDK inicializace
- **`components/ui/Pagination.tsx`** - reusable pagination komponenta pro tabulky
- **`components/ui/DetailTooltip.tsx`** - reusable detailnÃ­ tooltip komponenta pro zobrazenÃ­ komplexnÃ­ch informacÃ­
- **`components/ui/TooltipCell.tsx`** - wrapper pro `<td>` element s tooltipem (automaticky Å™eÅ¡Ã­ overflow)
- **`components/ui/ActionIconTooltip.tsx`** - reusable tooltip komponenta pro ikony akcÃ­ v tabulkÃ¡ch
- **`vite.config.ts`** - automatickÃ© verzovÃ¡nÃ­ z package.json pÅ™i buildu
- **`components/ReportView.tsx`** - zobrazenÃ­ reportÅ¯ (UPRAVENO - pÅ™idÃ¡ny zÃ¡loÅ¾ky Legacy/Smart)
- **`SMART_TEMPLATE_IMPLEMENTATION_PLAN.md`** - detailnÃ­ plÃ¡n Smart Template systÃ©mu
- **`FLOWBITE_PRIRUCKA.md`** - Flowbite pÅ™Ã­ruÄka
- **`NAVOD.md`** - nÃ¡vod k nastavenÃ­ a deploy

---

## ğŸ”§ WORKFLOW PRO ZMÄšNY

### PÅ™i zmÄ›nÄ› UI komponenty:

1. **Zkontroluj Flowbite dokumentaci** - https://flowbite-react.com/
2. **PodÃ­vej se do `FLOWBITE_PRIRUCKA.md`** - mÃ¡Å¡ tam pÅ™Ã­klady
3. **PouÅ¾ij Flowbite komponentu** podle dokumentace
4. **Zachovej pÅ¯vodnÃ­ barvy** pÅ™es inline styles
5. **Otestuj v light mode** - aplikace je vÅ¾dy svÄ›tlÃ¡
6. **Pro tooltips pouÅ¾ij reusable komponenty** - `DetailTooltip`, `TooltipCell` a `ActionIconTooltip` z `components/ui/`

### PÅ™i prÃ¡ci s Firebase:

1. **Zkontroluj existujÃ­cÃ­ service funkce** v `services/firestore/`
2. **PouÅ¾ij existujÃ­cÃ­ funkce** mÃ­sto pÅ™Ã­mÃ©ho Firebase SDK
3. **Respektuj security rules** - uÅ¾ivatelÃ© jsou izolovÃ¡ni
4. **PÅ™idej error handling** - vÅ¡echny operace mohou selhat

---

## âœ… CHECKLIST PÅ˜ED COMMITEM

### UI zmÄ›ny:
- [ ] PouÅ¾il jsem Flowbite komponentu podle dokumentace?
- [ ] Zachoval jsem pÅ¯vodnÃ­ barvy pÅ™es inline styles?
- [ ] Komponenta funguje v light mode?
- [ ] NenÃ­ tam Å¾Ã¡dnÃ½ dark mode CSS?
- [ ] **Aktualizoval jsem dokumentaci pokud byla zmÄ›na zÃ¡sadnÃ­?**

### Firebase zmÄ›ny:
- [ ] PouÅ¾il jsem existujÃ­cÃ­ service funkce?
- [ ] PÅ™idal jsem error handling?
- [ ] Security rules jsou sprÃ¡vnÄ› nastavenÃ©?
- [ ] **Aktualizoval jsem dokumentaci pokud byla zmÄ›na zÃ¡sadnÃ­?**

### ObecnÃ©:
- [ ] KÃ³d je TypeScript validnÃ­?
- [ ] Build prochÃ¡zÃ­ (`npm run build`)?
- [ ] **Aktualizoval jsem `.cursorrules` nebo jinou dokumentaci pokud byla zmÄ›na zÃ¡sadnÃ­?**

---

## ğŸš¨ ÄŒASTÃ‰ CHYBY

1. **NepouÅ¾itÃ­ Flowbite dokumentace** - VÅ½DY zkontroluj https://flowbite-react.com/
2. **Dark mode tÅ™Ã­dy** - Aplikace je vÅ¾dy svÄ›tlÃ¡, nepouÅ¾Ã­vej dark mode
3. **Tailwind gradienty mÃ­sto inline styles** - PouÅ¾Ã­vej inline styles pro gradienty
4. **PÅ™Ã­mÃ½ Firebase SDK v komponentÃ¡ch** - PouÅ¾Ã­vej service funkce z `services/firestore/`
5. **Icon jako JSX mÃ­sto funkce** - Flowbite vyÅ¾aduje `icon={() => <Icon />}`

---

## ğŸ“š DÅ®LEÅ½ITÃ‰ ODKAZY

### Dokumentace:
- **Flowbite React**: https://flowbite-react.com/
- **Firebase**: https://firebase.google.com/docs

### ProjektovÃ© soubory:
- **Flowbite pÅ™Ã­ruÄka**: `FLOWBITE_PRIRUCKA.md`
- **Firebase nÃ¡vod**: `NAVOD.md`
- **README**: `README.md`
- **Smart Template plÃ¡n**: `SMART_TEMPLATE_IMPLEMENTATION_PLAN.md`
- **Smart Template spec**: `HACCP_Smart_Template_Report_System.md`

---

## âš ï¸ POKUD NÄšCO NEVÃÅ 

1. **Zkontroluj dokumentaci** - Flowbite nebo Firebase
2. **PodÃ­vej se do projektovÃ½ch souborÅ¯** - `FLOWBITE_PRIRUCKA.md`, `NAVOD.md`
3. **Zkontroluj podobnÃ½ kÃ³d** v projektu - jak se to dÄ›lÃ¡ jinde
4. **Pokud nedokÃ¡Å¾eÅ¡ vyÅ™eÅ¡it** - napiÅ¡ uÅ¾ivateli konkrÃ©tnÄ› kde to najde nebo jak na to

---

## ğŸ“‘ TAB (KARTY) SYSTÃ‰M

### ZÃ¡kladnÃ­ principy

**Taby se pouÅ¾Ã­vajÃ­ pouze pro:**
- âœ… `AUDIT_LIST` - Seznam auditÅ¯ pro pracoviÅ¡tÄ›
- âœ… `AUDIT_IN_PROGRESS` - ProbÃ­hajÃ­cÃ­ audit (checklist)
- âœ… `REPORT_VIEW` - ZobrazenÃ­ reportu

**Taby se NEPOUÅ½ÃVAJÃ pro:**
- âŒ HlavnÃ­ obrazovky (dashboard, seznamy) - pÅ™Ã­stupnÃ© pÅ™es sidebar
- âŒ FormulÃ¡Å™e (ADD_*, EDIT_*) - otevÃ­rajÃ­ se jako overlay
- âŒ NastavenÃ­ a dalÅ¡Ã­ obrazovky

### Logika vytvÃ¡Å™enÃ­ tabÅ¯

**CentrÃ¡lnÃ­ funkce:** `openOrActivateTab()` v `App.tsx`

```typescript
openOrActivateTab(
  auditId: string | undefined,
  tabType: 'audit' | 'report' | 'audit_list',
  premiseId: string,
  operatorName: string,
  premiseName?: string,
  auditDate?: string,
  status?: string
): string
```

**ChovÃ¡nÃ­:**
1. Pokud existuje tab pro stejnÃ½ audit/premise â†’ aktivuje se existujÃ­cÃ­ tab
2. Pokud existuje tab s jinÃ½m typem â†’ aktualizuje se typ tabu
3. Pokud tab neexistuje â†’ vytvoÅ™Ã­ se novÃ½ tab

**VÅ¡echna mÃ­sta vytvÃ¡Å™enÃ­ tabÅ¯ pouÅ¾Ã­vajÃ­ tuto centrÃ¡lnÃ­ funkci:**
- `handleSelectPremiseForAudits()` - audit_list tab
- `handleStartNewAudit()` - audit tab
- `handleUnlockAudit()` - audit tab
- `handleSelectAudit()` - audit nebo report tab
- `handleFinishAudit()` - report tab
- `handleHeaderUpdateAndContinue()` - audit tab

### FormÃ¡t nÃ¡zvÅ¯ tabÅ¯

- **audit_list**: "Audity ([NÃ¡zev pracoviÅ¡tÄ›])"
- **audit**: "Audit ([NÃ¡zev provozovatele])"
- **report**: "Report ([NÃ¡zev provozovatele])"

### Tooltips

KaÅ¾dÃ½ tab mÃ¡ `title` atribut s detaily:
- **audit_list**: "Seznam auditÅ¯ - [Provozovatel] ([PracoviÅ¡tÄ›])"
- **audit**: "Audit - [Provozovatel] ([PracoviÅ¡tÄ›]) - [Datum] - [Status]"
- **report**: "Report - [Provozovatel] ([PracoviÅ¡tÄ›]) - [Datum] - [Status]"

### "ZpÄ›t" navigace

**`handleBackToAuditList()`:**
- Pokud je aktivnÃ­ `audit_list` tab â†’ vracÃ­ na pÅ™edchozÃ­ view (OPERATOR_DASHBOARD)
- Pokud je aktivnÃ­ `audit` nebo `report` tab â†’ vracÃ­ na AUDIT_LIST pro danÃ© pracoviÅ¡tÄ›
- Pokud nejsou taby â†’ vracÃ­ na pÅ™edchozÃ­ appState

**Komponenty s "ZpÄ›t" tlaÄÃ­tkem:**
- `ReportView` - volÃ¡ `onBack={handleBackToAuditList}`
- `AuditChecklist` - volÃ¡ `onBack={handleBackToAuditList}`
- `HeaderForm` - volÃ¡ `onBack={handleBackToAuditList}`

### ZobrazenÃ­ TabBar

- **Desktop (xl+)**: TabBar se zobrazuje pod headerem (pouze jedenkrÃ¡t)
- **Mobile/Tablet**: TabBar se nezobrazuje (taby nejsou podporovÃ¡ny na malÃ½ch obrazovkÃ¡ch)
- **RenderovÃ¡nÃ­**: `components/Layout.tsx` - pouze pokud `tabs.length > 0`

### DÅ¯leÅ¾itÃ© soubory

- **`App.tsx`** - centrÃ¡lnÃ­ logika tabÅ¯ (`openOrActivateTab`, `handleTabClick`, `handleTabClose`)
- **`components/TabBar.tsx`** - UI komponenta pro zobrazenÃ­ tabÅ¯
- **`components/Layout.tsx`** - renderovÃ¡nÃ­ TabBar
- **`types.ts`** - Tab interface s `auditDate` a `status` pro tooltips

---

## ğŸ§© SMART TEMPLATE SYSTÃ‰M

### ZÃ¡kladnÃ­ principy
- **ParalelnÃ­ systÃ©m** - funguje vedle Legacy systÃ©mu, Å¾Ã¡dnÃ© zmÄ›ny v Legacy kÃ³du
- **Legacy systÃ©m zÅ¯stÃ¡vÃ¡ beze zmÄ›ny** - Å¾Ã¡dnÃ© Ãºpravy stÃ¡vajÃ­cÃ­ch komponent
- **UI pÅ™epÃ­naÄ** - uÅ¾ivatel si mÅ¯Å¾e vybrat mezi Legacy a Smart mÃ³dem v `ReportView`

### Struktura Smart Template
- **Template Rules** - JSON pravidla layoutu (uloÅ¾eny v `reportTemplates` collection)
- **ReportDocument** - struktura pÅ™ipravenÃ¡ pro render (WYSIWYG)
- **SmartTemplateEngine** - aplikuje pravidla Å¡ablony na audit data
- **Storage struktura**: `reports/{reportId}/smart/{drafts|finalVersions|pdf|templates}/`

### PÅ™i prÃ¡ci se Smart Template:
1. **VÅ¾dy pouÅ¾ij existujÃ­cÃ­ sluÅ¾by** z `services/smartTemplate/`
2. **NepouÅ¾Ã­vej pÅ™Ã­mÃ½ Firebase SDK** - pouÅ¾ij `reportDocumentService.ts`
3. **Respektuj strukturu Storage** - Smart data jsou v `smart/` podadresÃ¡Å™i
4. **Legacy systÃ©m beze zmÄ›ny** - Å¾Ã¡dnÃ© Ãºpravy `ReportView.tsx` Legacy ÄÃ¡sti

### DÅ¯leÅ¾itÃ© soubory Smart Template:
- `SMART_TEMPLATE_IMPLEMENTATION_PLAN.md` - detailnÃ­ plÃ¡n implementace
- `HACCP_Smart_Template_Report_System.md` - pÅ¯vodnÃ­ specifikace
- `services/smartTemplate/SmartTemplateEngine.ts` - engine pro aplikaci pravidel
- `components/report/SmartTemplateView.tsx` - hlavnÃ­ UI komponenta

### âš ï¸ PÅ™i implementaci Smart Template:
- VÅ¾dy ovÄ›Å™, Å¾e Legacy systÃ©m funguje beze zmÄ›ny
- PouÅ¾Ã­vej Flowbite komponenty pro UI (Tabs, Button, atd.)
- Dokumentuj vÅ¡echny novÃ© typy v `types/smartReport.ts`
- Aktualizuj security rules pro novÃ© collections a Storage cesty

---

## ğŸ“± RESPONSIVITA A BREAKPOINTY

### Breakpoint strategie
- **Mobile** (<768px): Hamburger menu, mobilnÃ­ karty
- **Tablet** (768-1279px): Top horizontal bar, desktop tabulky
- **Desktop Small** (1280-1919px): Sidebar s texty
- **Desktop Large** (1920px+): Full sidebar s texty

### Navigace podle zaÅ™Ã­zenÃ­
- **Mobil**: MobileMenu overlay (hamburger)
- **Tablet**: Top horizontal bar s ikonami (skrytÃ½ sidebar)
- **Desktop**: Sidebar vlevo (skrytÃ½ na < 1280px)

### StrÃ¡nkovÃ¡nÃ­ tabulek
- DefaultnÄ› 20 poloÅ¾ek/strÃ¡nka
- MoÅ¾nost vÃ½bÄ›ru: 10, 20, 50, 100
- Komponenta: `components/ui/Pagination.tsx`
- ImplementovÃ¡no v: OperatorDashboard, AllAuditsScreen, AuditList

### User Avatar
- Pouze jedno mÃ­sto: vpravo nahoÅ™e v top baru (desktop) nebo v tablet top bar
- FormÃ¡t: pouze iniciÃ¡la v kruhu, bez ikony

### ResponzivnÃ­ tabulky
- Padding: `px-3 md:px-4 xl:px-6 py-3 md:py-4`
- Ikony: `h-4 w-4 md:h-5 md:w-5 xl:h-4 xl:w-4`
- TlaÄÃ­tka: `p-1 md:p-2 xl:p-1`
- HorizontÃ¡lnÃ­ scroll: `min-w-[900px] xl:min-w-0` wrapper

---

## ğŸ“‘ TOOLTIP SYSTÃ‰M

### Reusable Tooltip Komponenty

**DetailTooltip** (`components/ui/DetailTooltip.tsx`):
- Komponenta pro zobrazenÃ­ detailnÃ­ch informacÃ­ pÅ™i hoveru
- Automaticky Å™eÅ¡Ã­ pozicovÃ¡nÃ­ (top/bottom) a z-index
- PouÅ¾Ã­vÃ¡ se pro provozovatele, pracoviÅ¡tÄ› a dalÅ¡Ã­ komplexnÃ­ tooltips

**TooltipCell** (`components/ui/TooltipCell.tsx`):
- Wrapper pro `<td>` element s tooltipem
- Automaticky pÅ™idÃ¡vÃ¡ `overflow-hidden` a `has-[.group:hover]:overflow-visible`
- ZajiÅ¡Å¥uje sprÃ¡vnÃ© zobrazenÃ­ tooltipu mimo Å™Ã¡dek

**ActionIconTooltip** (`components/ui/ActionIconTooltip.tsx`):
- Komponenta pro zobrazenÃ­ tooltipu u ikon akcÃ­ v tabulkÃ¡ch
- Automaticky Å™eÅ¡Ã­ pozicovÃ¡nÃ­ (pod ikonou, nebo nad pokud je poslednÃ­ Å™Ã¡dek)
- ZajiÅ¡Å¥uje okamÅ¾itÃ© zobrazenÃ­ bez zpoÅ¾dÄ›nÃ­
- PouÅ¾Ã­vÃ¡ se pro vÅ¡echny ikony akcÃ­ (Edit, Delete, Add, atd.)

**PouÅ¾itÃ­:**
```tsx
import { DetailTooltip } from './ui/DetailTooltip';
import { TooltipCell } from './ui/TooltipCell';
import { ActionIconTooltip } from './ui/ActionIconTooltip';

<TooltipCell className="px-3 md:px-2 xl:px-6 py-3 md:py-2 xl:py-4">
  <DetailTooltip
    position={isLastRow ? 'top' : 'bottom'}
    content={
      <div className="space-y-1.5">
        <div className="font-bold text-sm mb-2 pb-2 border-b border-gray-700">
          {operator.operator_name}
        </div>
        {/* dalÅ¡Ã­ obsah */}
      </div>
    }
  >
    <span className="cursor-help truncate block w-full">
      {operator.operator_name}
    </span>
  </DetailTooltip>
</TooltipCell>

<div className="relative group/button">
  <button className="...">
    <Icon />
  </button>
  <ActionIconTooltip text="Upravit" isLastRow={isLastRow} />
</div>
```

**Pravidla:**
- VÅ½DY pouÅ¾Ã­vej `DetailTooltip` a `TooltipCell` pro detailnÃ­ tooltips
- VÅ½DY pouÅ¾Ã­vej `ActionIconTooltip` pro tooltips u ikon akcÃ­
- Tooltip se zobrazuje pouze pÅ™i hoveru na konkrÃ©tnÃ­ hodnotu/ikonu, ne na celÃ½ Å™Ã¡dek
- Pro poslednÃ­ Å™Ã¡dek tabulky pouÅ¾ij `isLastRow={true}` pro `DetailTooltip` a `ActionIconTooltip`, jinak `isLastRow={false}` nebo vynechej (default je `false`)
- Tooltip obsahuje tmavÃ© pozadÃ­ (`bg-gray-900`) a bÃ­lÃ½ text
- MinimÃ¡lnÃ­ Å¡Ã­Å™ka pro `DetailTooltip`: `250px`, maximÃ¡lnÃ­: `350px` (lze zmÄ›nit pÅ™es props)
- `ActionIconTooltip` se zobrazuje okamÅ¾itÄ›, bez zpoÅ¾dÄ›nÃ­ (`transition-opacity` je odstranÄ›n)
- NIKDY nepouÅ¾Ã­vej `title` atributy na tlaÄÃ­tkÃ¡ch s ikonami - zpÅ¯sobujÃ­ duplicitnÃ­ tooltips

---

**PAMATUJ SI: Dokumentace je tvÅ¯j nejlepÅ¡Ã­ pÅ™Ã­tel - vÅ¾dy ji kontroluj pÅ™ed psanÃ­m kÃ³du!**
